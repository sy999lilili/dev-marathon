<!--
 それぞれの顧客テーブルの内容を表示するページ

顧客テーブル：
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    industry VARCHAR(255) NOT NULL,
    contact VARCHAR(20) NOT NULL UNIQUE CHECK (contact <> ''),
    location VARCHAR(255) NOT NULL,
    created_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
); 
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initi  al-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h1>Customer Detail</h1>
  <div id="customer-detail">
    <!-- 顧客の詳細情報はここに挿入されます -->
  </div>
  <!-- 編集ボタン -->
  <button id="edit-button" class="btn btn-primary">Edit Customer</button>
  <!-- 削除ボタン -->
  <button id="delete-button" class="btn btn-danger">Delete Customer</button>
  <a href="list.html">Back to Customer List</a>

  <script type="module">
    import config from "../config.js";

    const urlParams = new URLSearchParams(window.location.search);
    const customerId = urlParams.get('id');

    fetch(`${config.apiUrl}/customers/${customerId}`)
      .then(async response => {
        if (!response.ok) {
          // エラー時はテキストとして取得
          const text = await response.text();
          throw new Error(`サーバーエラー: ${response.status} ${text}`);
        }
        return response.json();
      })
      .then(data => {
        const detailDiv = document.getElementById("customer-detail");
        detailDiv.innerHTML = `
        <p><strong>Company Name:</strong> ${data.company_name}</p>
        <p><strong>Industry:</strong> ${data.industry}</p>
        <p><strong>Contact:</strong> ${data.contact}</p>
        <p><strong>Location:</strong> ${data.location}</p>
        <p><strong>Created Date:</strong> ${new Date(data.created_date).toLocaleDateString()}</p>
        <p><strong>Updated Date:</strong> ${new Date(data.updated_date).toLocaleDateString()}</p>
      `;
      })
      .catch(error => {
        const detailDiv = document.getElementById("customer-detail");
        detailDiv.innerHTML = `<p style="color:red;">データ取得エラー: ${error.message}</p>`;
        console.error('Error fetching customer data:', error);
      });

    // 削除ボタンをクリックしたら「削除していいですか?」をalert関数で表示
    document.getElementById("delete-button").addEventListener("click", () => {
      if (confirm("Are you sure you want to delete this customer?")) {
        fetch(`${config.apiUrl}/customers/${customerId}`, {
          method: 'DELETE'
        })
          .then(response => {
            if (!response.ok) {
              throw new Error(`Error: ${response.status}`);
            }
            alert("Customer deleted successfully.");
            window.location.href = "list.html"; // 削除後にリストページへリダイレクト
          })
          .catch(error => {
            alert(`Error deleting customer: ${error.message}`);
          });
      }
    });
  </script>
</body>
</html>
